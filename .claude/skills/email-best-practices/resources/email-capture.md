# メールアドレス収集のベストプラクティス

バリデーション、認証、適切な同意取得によるメールアドレスの責任ある収集。

## メールバリデーション

### クライアントサイド

**HTML5:**
```html
<input type="email" required>
```

**ベストプラクティス:**
- blur イベントまたは短いデバウンスでバリデーション
- 明確なエラーメッセージを表示
- 過度に厳密にしない（珍しいが有効な形式も許可）
- クライアントサイドのバリデーション ≠ 到達性の保証

### サーバーサイド（推奨）

クライアントサイドはバイパス可能なため、必ずサーバーサイドでもバリデーションする。

**チェック項目:**
- メール形式（RFC 5322）
- ドメインの存在確認（DNS ルックアップ）
- ドメインの MX レコード確認
- オプション: 使い捨てメールの検出

推奨ツール: https://resend.com/blog/best-email-verification-apis

## ダブルオプトイン

メールアドレスがユーザー本人のもので、配信可能であることを確認する仕組み。

### プロセス

1. ユーザーがメールアドレスを送信
2. 一意のリンク/トークン付きの確認メールを送信
3. ユーザーがリンクをクリック
4. 認証済みとしてマーク
5. アクセス許可/リストに追加

**タイミング:** 即座に送信、有効期限あり（24〜48 時間）、60 秒後に再送可能、再送回数を制限（3 回/時間）。

### シングルオプトイン vs ダブルオプトイン

| | シングルオプトイン | ダブルオプトイン |
|--|---------------|---------------|
| **プロセス** | 即座にリストに追加 | メール確認を先に要求 |
| **メリット** | 低い摩擦、速い成長 | 認証済みアドレス、高いエンゲージメント、GDPR/CASL 準拠 |
| **デメリット** | 無効アドレス率が高い、低いエンゲージメント | 確認しないユーザーがいる |
| **用途** | アカウント作成、トランザクショナル | マーケティングリスト、ニュースレター |

**推奨:** マーケティングメールにはすべてダブルオプトインを使用。

## フォームデザイン

### メール入力フィールド

- モバイルキーボード用に `type="email"` を使用
- プレースホルダーを含める（"you@example.com"）
- 明確なエラーメッセージ（"Invalid" ではなく "有効なメールアドレスを入力してください"）

### 同意チェックボックス（マーケティング）

- **デフォルトで未チェック**（必須）
- 何に登録するかの具体的な文言
- メールの種類ごとに別々のチェックボックス
- プライバシーポリシーへのリンク

```
☐ 製品アップデートを含む週刊ニュースレターを購読する
☐ プロモーションオファーやお得な情報を受け取る
```

**NG:** チェック済みボックス、曖昧な文言、利用規約への埋め込み。

### フォームレイアウト

- シンプルで焦点を絞る
- 主要アクションは 1 つ
- 明確な価値提案
- モバイルフレンドリー
- アクセシブル（label、ARIA）

## エラーハンドリング

### 無効なメール

- 明確なエラーメッセージを表示
- よくあるタイプミスに対する修正候補を提示（@gmial.com → @gmail.com）
- 修正して再送信できるようにする

### 既に登録済み

- アカウント: 「このメールアドレスは既に登録されています。[ログイン]」
- マーケティング: 「既に購読済みです！[配信設定の管理]」
- アカウントの存在を明かさない（セキュリティ上の理由）

### レート制限

- 確認メールの制限（メールアドレスごとに 3 回/時間）
- フォーム送信のレート制限
- 必要に応じて CAPTCHA を控えめに使用
- 不正利用パターンの監視

## 確認メール

**コンテンツ:**
- 明確な目的（「メールアドレスを確認してください」）
- 目立つ確認ボタン
- 有効期限
- 再送オプション
- 「心当たりがない場合」の案内
- OTP/2FA コードを件名やプレビューテキストに含めない（開封率が低下するため）

**デザイン:**
- モバイルフレンドリー
- 大きくタップしやすいボタン
- 明確な CTA

詳しくは[トランザクショナルメール](./transactional-emails.md)を参照。

## 関連

- [法令遵守](./compliance.md) - 同意に関する法的要件（GDPR、CASL）
- [マーケティングメール](./marketing-emails.md) - アドレス収集後の対応
- [到達性](./deliverability.md) - バリデーションが送信者レピュテーションに与える影響
